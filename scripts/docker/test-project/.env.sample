# Test Environment Configuration for compose-init-up.py
# This file tests ALL variations of password/token generation and hook integration
# DO NOT use this in production - it's designed purely for testing compose-init-up features

# ========================================================================
# SECTION 1: Compose-Init Control Variables (mandatory)
# ========================================================================

COMPINIT_COMPOSE_START_MODE=abort-on-failure
COMPINIT_RESET_BEFORE_START=none  
COMPINIT_IMAGE_CHECK_CONTINUE_ON_ERROR=1
COMPINIT_CHECK_IMAGE_ENABLED=false
COMPINIT_MYREGISTRY_URL=

# Hook scripts - will be created in this test directory
COMPINIT_HOOK_PRE_COMPOSE=./pre_compose_hook.py
COMPINIT_HOOK_POST_COMPOSE=./post_compose_hook.py

# Optional: when true, expand $VAR and $(cmd) in loaded env values at runtime
COMPINIT_ENABLE_ENV_EXPANSION=false

# ========================================================================
# SECTION 2: Infrastructure (standard pattern)
# ========================================================================

PUBLIC_FQDN=test-project.local
PUBLIC_TLS_KEY_PEM=/tmp/test-key.pem
PUBLIC_TLS_CRT_PEM=/tmp/test-cert.pem

# ========================================================================
# SECTION 3: Project Metadata
# ========================================================================

LABEL_ENV_TAG=test
LABEL_PREFIX=test.compose-init
LABEL_PROJECT_NAME=compose-init-test

# ========================================================================
# SECTION 4: Health Monitoring
# ========================================================================

HEALTHCHECK_INTERVAL=5s
HEALTHCHECK_TIMEOUT=3s
HEALTHCHECK_RETRIES=2
HEALTHCHECK_START_PERIOD=10s

# ========================================================================
# SECTION 5: Global Variables (GLOBAL_ prefix pattern)
# ========================================================================

GLOBAL_TEST_MODE=true
GLOBAL_DEBUG_ENABLED=true

# ========================================================================
# SECTION 6: PASSWORD Generation Tests
# ========================================================================

# Test 1: Simple password auto-generation (empty value)
DB_ADMIN_PASSWORD=

# Test 2: Password with existing value (should not regenerate)
DB_USER_PASSWORD=predefined_password_12345

# Test 3: Deferred password (post-compose hook will generate)
PORTUS_ADMIN_PASSWORD_DEFERED=

# Test 4: Password descriptor - ALNUM 32 chars
API_SECRET_PASSWORD_ALNUM32=

# Test 5: Password descriptor - HEX 64 chars
ENCRYPTION_KEY_PASSWORD_HEX64=

# Test 6: Password descriptor with DEFERED suffix
DELAYED_SERVICE_PASSWORD_ALNUM16_DEFERED=

# ========================================================================
# SECTION 7: TOKEN Generation Tests - INTERNAL variant
# ========================================================================

# Test 7: Internal token auto-generation (empty value)
SERVICE_AUTH_TOKEN_INTERNAL=

# Test 8: Internal token with value (should not regenerate)
CACHE_TOKEN_INTERNAL=predefined_internal_token_xyz

# Test 9: Deferred internal token
ROBOT_TOKEN_INTERNAL_DEFERED=

# Test 10: Token descriptor INTERNAL - ALNUM 48
WEBHOOK_SECRET_TOKEN_ALNUM48_INTERNAL=

# Test 11: Token descriptor INTERNAL - HEX 32
SESSION_KEY_TOKEN_HEX32_INTERNAL=

# ========================================================================
# SECTION 8: TOKEN Generation Tests - EXTERNAL variant
# ========================================================================

# Test 12: External token (should prompt or use env if available)
GITHUB_PAT_TOKEN_EXTERNAL=

# Test 13: External token with value (should keep it)
DOCKER_REGISTRY_TOKEN_EXTERNAL=ghp_predefined_external_token_abc123

# Test 14: Deferred external token
PORTUS_ROBOT_TOKEN_EXTERNAL_DEFERED=

# Test 15: Token descriptor EXTERNAL - ALNUM 64
RUNNER_REGISTRATION_TOKEN_ALNUM64_EXTERNAL=

# Test 16: Token descriptor EXTERNAL - HEX 40
API_KEY_TOKEN_HEX40_EXTERNAL=

# ========================================================================
# SECTION 9: TOKEN Generation Tests - DEFERED variant
# ========================================================================

# Test 17: Deferred token (generic)
ADMIN_API_TOKEN_DEFERED=

# Test 18: Token descriptor DEFERED - ALNUM 56
PORTUS_APPLICATION_TOKEN_ALNUM56_DEFERED=

# Test 19: Token descriptor DEFERED - HEX 48
SERVICE_MESH_TOKEN_HEX48_DEFERED=

# ========================================================================
# SECTION 10: Descriptor Variants - Edge Cases
# ========================================================================

# Test 20: Very short descriptor
SHORT_TOKEN_ALNUM8=

# Test 21: Very long descriptor
LONG_TOKEN_HEX128=

# Test 22: Minimum length descriptor
MIN_PASSWORD_ALNUM1=

# Test 23: Multiple descriptors same charset
APP1_TOKEN_ALNUM24=
APP2_TOKEN_ALNUM24=
APP3_TOKEN_ALNUM24=

# ========================================================================
# SECTION 11: Command Substitution and Variable Expansion
# ========================================================================

# Test 24: Command substitution for UID/GID
UID=$(id -u)
GID=$(id -g)

# Test 25: Variable reference
USER_HOME=/home/testuser
USER_CACHE_DIR=${USER_HOME}/.cache

# Test 26: Nested variable reference
PUBLIC_URL=https://${PUBLIC_FQDN}
API_ENDPOINT=${PUBLIC_URL}/api/v1

# Test 27: Command substitution in path
CURRENT_DATE=$(date +%Y%m%d)
BACKUP_PATH=/backups/backup-${CURRENT_DATE}

# ========================================================================
# SECTION 12: Host Directory Mappings (vol-* pattern)
# ========================================================================

# These should trigger directory creation by compose-init-up
DB_HOSTDIR_DATA=./vol-db-data
REDIS_HOSTDIR_DATA=./vol-redis-data
APP_HOSTDIR_LOGS=./vol-app-logs
APP_HOSTDIR_CACHE=./vol-app-cache
NGINX_HOSTDIR_CONFIG=./vol-nginx-config

# ========================================================================
# SECTION 13: Variables Set by Pre-Compose Hook
# ========================================================================

# These will be populated by the pre-compose hook script
# (simulating GitHub runner registration or external secret fetch)
PRECOMPOSE_RUNNER_TOKEN=
PRECOMPOSE_WEBHOOK_SECRET=
PRECOMPOSE_EXTERNAL_API_KEY=
PRECOMPOSE_TIMESTAMP=

# ========================================================================
# SECTION 14: Variables to be Set by Post-Compose Hook
# ========================================================================

# These will be extracted/generated by the post-compose hook script
# (simulating Portus admin setup or service initialization)
POSTCOMPOSE_ADMIN_USERNAME=
POSTCOMPOSE_ADMIN_TOKEN=
POSTCOMPOSE_DATABASE_VERSION=
POSTCOMPOSE_SERVICE_READY=

# ========================================================================
# SECTION 15: Special Characters and Edge Cases
# ========================================================================

# Test 28: Variable with comment inline
COMMENTED_PASSWORD=  # This should be auto-generated

# Test 29: Empty value with whitespace
WHITESPACE_TOKEN=     

# Test 30: Variable with URL-like value
CALLBACK_URL=https://example.com/callback?token=placeholder

# Test 31: Variable with JSON-like value
CONFIG_JSON={"key":"value","nested":{"item":"data"}}

# Test 32: Variable with equals sign in value
QUERY_STRING=param1=value1&param2=value2

# ========================================================================
# SECTION 16: Service-Specific Configuration
# ========================================================================

# Application settings
APP_NAME=compose-init-test
APP_VERSION=1.0.0-test
APP_LOG_LEVEL=debug
APP_WORKERS=2

# Database settings
DB_HOST=postgres
DB_PORT=5432
DB_NAME=testdb
DB_USER=testuser

# Redis settings
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0

# API settings
API_PORT=8080
API_RATE_LIMIT=100
API_TIMEOUT=30

# ========================================================================
# SECTION 17: Boolean and Numeric Values
# ========================================================================

ENABLE_FEATURE_A=true
ENABLE_FEATURE_B=false
MAX_CONNECTIONS=100
RETRY_COUNT=3
TIMEOUT_SECONDS=30
PI_VALUE=3.14159

# ========================================================================
# SECTION 18: Array-like Values
# ========================================================================

ALLOWED_HOSTS=localhost,127.0.0.1,test-project.local
CORS_ORIGINS=http://localhost:3000,https://test-project.local
SUPPORTED_LANGUAGES=en,de,fr,es

# ========================================================================
# SECTION 19: Multi-line or Complex Values (as single line)
# ========================================================================

CERTIFICATE_DATA=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURYVENDQWtXZ0F3SUJBZ0lKQUxZN=
SSH_PUBLIC_KEY=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC...truncated...

# ========================================================================
# End of test .env.sample
# ========================================================================
